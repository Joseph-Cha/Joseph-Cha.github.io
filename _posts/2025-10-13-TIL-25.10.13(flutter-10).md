---
title: "Today I Learned 17íšŒì°¨ - Flutter í¬í†  ìŠ¤í‹°ì»¤ ì•± êµ¬í˜„"
date: 2025-10-13T00:00:00-00:00
categories:
  - TIL
tags:
  - TIL
  - Flutter
  - GestureDetector
  - Transform
---

ì˜¤ëŠ˜ì€ Flutterë¡œ ì´ë¯¸ì§€ì— ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì—¬ ê¾¸ë°€ ìˆ˜ ìˆëŠ” í¬í†  ì—ë””í„° ì•±ì„ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤. GestureDetectorë¥¼ í™œìš©í•œ ë‹¤ì–‘í•œ ì œìŠ¤ì²˜ ì²˜ë¦¬ì™€ Transform ìœ„ì ¯ì„ í†µí•œ ìœ„ì¹˜/í¬ê¸° ì¡°ì ˆ ë°©ë²•ì„ ë°°ì› ì–´ìš”! ğŸ“¸âœ¨

## ğŸ¯ í•™ìŠµ ëª©í‘œ

- ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê³  ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì—¬ ê¾¸ë¯¸ëŠ” ì•± êµ¬í˜„
- ì œìŠ¤ì²˜ë¥¼ í™œìš©í•œ ìŠ¤í‹°ì»¤ì˜ í¬ê¸° ë° ìœ„ì¹˜ ì¡°ì ˆ
- Transform ìœ„ì ¯ì„ ì‚¬ìš©í•œ UI ë³€í™˜ ì²˜ë¦¬

## ğŸ“š í•™ìŠµ ë‚´ìš©

### 1. GestureDetectorì™€ ì œìŠ¤ì²˜

Flutterì—ì„œëŠ” GestureDetector ìœ„ì ¯ì„ í†µí•´ ë‹¤ì–‘í•œ í„°ì¹˜ ì œìŠ¤ì²˜ë¥¼ ê°ì§€í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì£¼ìš” ì œìŠ¤ì²˜ ì¢…ë¥˜

| ì œìŠ¤ì²˜ ë§¤ê°œë³€ìˆ˜ | ì„¤ëª… |
| --- | --- |
| onTap | í•œ ë²ˆ íƒ­í–ˆì„ ë•Œ ì‹¤í–‰ |
| onDoubleTap | ë‘ ë²ˆ ì—°ì† íƒ­í–ˆì„ ë•Œ ì‹¤í–‰ |
| onLongPress | ê¸¸ê²Œ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ |
| onScaleUpdate | í•€ì¹˜/í™•ëŒ€/ì¶•ì†Œ/íšŒì „ ì œìŠ¤ì²˜ ì‹œ ì‹¤í–‰ |
| onVerticalDragStart | ìˆ˜ì§ ë“œë˜ê·¸ ì‹œì‘ ì‹œ ì‹¤í–‰ |
| onVerticalDragEnd | ìˆ˜ì§ ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ì‹¤í–‰ |
| onHorizontalDragStart | ìˆ˜í‰ ë“œë˜ê·¸ ì‹œì‘ ì‹œ ì‹¤í–‰ |
| onHorizontalDragEnd | ìˆ˜í‰ ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ì‹¤í–‰ |
| onPanStart | ëª¨ë“  ë°©í–¥ ë“œë˜ê·¸ ì‹œì‘ ì‹œ ì‹¤í–‰ |
| onPanEnd | ëª¨ë“  ë°©í–¥ ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ì‹¤í–‰ |

### 2. Transform ìœ„ì ¯ìœ¼ë¡œ ìœ„ì¹˜ì™€ í¬ê¸° ì¡°ì ˆ

Transform ìœ„ì ¯ì€ Matrix4ë¥¼ ì‚¬ìš©í•˜ì—¬ ìì‹ ìœ„ì ¯ì˜ ìœ„ì¹˜, í¬ê¸°, íšŒì „ ë“±ì„ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥
- **translate**: ìœ„ì ¯ì˜ ìœ„ì¹˜ ì´ë™ (x, y, zì¶•)
- **scale**: ìœ„ì ¯ì˜ í¬ê¸° ì¡°ì ˆ
- **rotate**: ìœ„ì ¯ì˜ íšŒì „

### 3. RepaintBoundaryë¥¼ í™œìš©í•œ ì´ë¯¸ì§€ ì €ì¥

RepaintBoundaryëŠ” ìœ„ì ¯ íŠ¸ë¦¬ì˜ íŠ¹ì • ë¶€ë¶„ì„ ë…ë¦½ì ì¸ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ì—¬ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

#### ì´ë¯¸ì§€ ì €ì¥ ê³¼ì •
```
1. GlobalKeyë¡œ RepaintBoundary ì°¸ì¡°
2. RenderRepaintBoundary ê°ì²´ ê°€ì ¸ì˜¤ê¸°
3. toImage()ë¡œ ui.Image ìƒì„±
4. toByteData()ë¡œ ë°”ì´íŠ¸ ë°ì´í„° ë³€í™˜
5. ImageGallerySaverPlusë¡œ ê°¤ëŸ¬ë¦¬ì— ì €ì¥
```

## ğŸ’» êµ¬í˜„ ì½”ë“œ

### HomeScreen - ë©”ì¸ í™”ë©´

```dart
class _HomeScreenState extends State<HomeScreen> {
  XFile? image;                    // ì„ íƒëœ ì´ë¯¸ì§€
  Set<StickerModel> stickers = {}; // ìŠ¤í‹°ì»¤ ëª©ë¡ (Setìœ¼ë¡œ ì¤‘ë³µ ë°©ì§€)
  String? selectedId;              // ì„ íƒëœ ìŠ¤í‹°ì»¤ ID
  GlobalKey imgKey = GlobalKey();  // ì´ë¯¸ì§€ ì €ì¥ì„ ìœ„í•œ Key

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Stack(
        children: [
          renderBody(),
          // ìƒë‹¨ ì•±ë°” (ì´ë¯¸ì§€ ì„ íƒ, ì €ì¥, ì‚­ì œ)
          Positioned(
            top: 0,
            left: 0,
            right: 0,
            child: MainAppBar(
              onPickImage: onPickImage,
              onSaveImage: onSaveImage,
              onDeleteImage: onDeleteImage,
            ),
          ),
          // í•˜ë‹¨ ìŠ¤í‹°ì»¤ ì„ íƒ ë°”
          if (image != null)
            Positioned(
              bottom: 0,
              left: 0,
              right: 0,
              child: Footer(onEmotionTap: onEmotionTap),
            ),
        ],
      ),
    );
  }

  // ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥
  void onSaveImage() async {
    RenderRepaintBoundary boundary =
        imgKey.currentContext!.findRenderObject() as RenderRepaintBoundary;
    ui.Image image = await boundary.toImage();
    ByteData? byteData = await image.toByteData(format: ui.ImageByteFormat.png);
    Uint8List pngByte = byteData!.buffer.asUint8List();
    await ImageGallerySaverPlus.saveImage(pngByte, quality: 100);
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'))
    );
  }
}
```

### EmoticonSticker - ìŠ¤í‹°ì»¤ ìœ„ì ¯

```dart
class _EmoticonStickerState extends State<EmoticonSticker> {
  double scale = 1;          // í˜„ì¬ ìŠ¤ì¼€ì¼
  double hTransform = 0;     // ìˆ˜í‰ ì´ë™ ê±°ë¦¬
  double vTransform = 0;     // ìˆ˜ì§ ì´ë™ ê±°ë¦¬
  double actualScale = 1;    // ì‹¤ì œ ìŠ¤ì¼€ì¼ (ì œìŠ¤ì²˜ ì¢…ë£Œ ì‹œ ì €ì¥)

  @override
  Widget build(BuildContext context) {
    return Transform(
      // Matrix4ë¥¼ ì‚¬ìš©í•œ ë³€í™˜
      transform: Matrix4.identity()
        ..translate(hTransform, vTransform)  // ìœ„ì¹˜ ì´ë™
        ..scale(scale, scale),               // í¬ê¸° ì¡°ì ˆ
      child: Container(
        // ì„ íƒëœ ìŠ¤í‹°ì»¤ëŠ” íŒŒë€ìƒ‰ í…Œë‘ë¦¬ í‘œì‹œ
        decoration: widget.isSelected
            ? BoxDecoration(
                borderRadius: BorderRadius.circular(4.0),
                border: Border.all(color: Colors.blue, width: 1.0),
              )
            : BoxDecoration(
                border: Border.all(width: 1.0, color: Colors.transparent),
              ),
        child: GestureDetector(
          onTap: widget.onTransform,  // íƒ­ ì‹œ ì„ íƒ
          onScaleUpdate: (details) {
            widget.onTransform();
            setState(() {
              // í•€ì¹˜ ì œìŠ¤ì²˜ë¡œ í¬ê¸° ì¡°ì ˆ
              scale = details.scale * actualScale;
              // ë“œë˜ê·¸ë¡œ ìœ„ì¹˜ ì´ë™
              vTransform += details.focalPointDelta.dy;
              hTransform += details.focalPointDelta.dx;
            });
          },
          onScaleEnd: (details) {
            // ì œìŠ¤ì²˜ ì¢…ë£Œ ì‹œ í˜„ì¬ ìŠ¤ì¼€ì¼ ì €ì¥
            actualScale = scale;
          },
          child: Image.asset(widget.imgPath),
        ),
      ),
    );
  }
}
```

### StickerModel - ìŠ¤í‹°ì»¤ ë°ì´í„° ëª¨ë¸

```dart
class StickerModel {
  final String id;       // UUIDë¡œ ìƒì„±ëœ ê³ ìœ  ID
  final String imgPath;  // ì´ë¯¸ì§€ ê²½ë¡œ

  StickerModel({required this.id, required this.imgPath});

  // Setì—ì„œ ì¤‘ë³µì„ ì œê±°í•˜ê¸° ìœ„í•œ ë™ë“±ì„± ë¹„êµ
  @override
  bool operator ==(Object other) {
    return (other as StickerModel).id == id;
  }

  @override
  int get hashCode => id.hashCode;
}
```

## ğŸ’¡ í•µì‹¬ ê°œë… ì •ë¦¬

### GestureDetectorì˜ ì œìŠ¤ì²˜ ì²˜ë¦¬ íë¦„
```
ì‚¬ìš©ì í„°ì¹˜
  â†“
onScaleUpdate â†’ scale, focalPointDelta ê°’ ì „ë‹¬
  â†“
setState() â†’ Transform ìœ„ì ¯ì˜ matrix ì—…ë°ì´íŠ¸
  â†“
í™”ë©´ì— ë°˜ì˜ (ìœ„ì¹˜/í¬ê¸° ë³€ê²½)
  â†“
onScaleEnd â†’ actualScaleì— ìµœì¢… ê°’ ì €ì¥
```

### Transform + Matrix4 ë³€í™˜
```
Matrix4.identity()
  â”œâ”€ translate(x, y, z) â†’ ìœ„ì¹˜ ì´ë™
  â”œâ”€ scale(x, y, z)     â†’ í¬ê¸° ì¡°ì ˆ
  â””â”€ rotate(angle)      â†’ íšŒì „
```

### RepaintBoundary ì €ì¥ ê³¼ì •
```
RepaintBoundary (GlobalKeyë¡œ ì°¸ì¡°)
  â†“
RenderRepaintBoundary ê°ì²´
  â†“
ui.Image (toImage())
  â†“
ByteData (toByteData())
  â†“
ê°¤ëŸ¬ë¦¬ ì €ì¥ (ImageGallerySaverPlus)
```

## ì‘ì—… ê²°ê³¼ë¬¼

<div align="center">
  <img src="../assets/images/TIL/2025-10-13-(1).png" width="500">
</div>

## ğŸš€ ë‹¤ìŒ í•™ìŠµ ëª©í‘œ

1. **íšŒì „ ê¸°ëŠ¥ ì¶”ê°€**: Transform.rotateë¥¼ í™œìš©í•œ ìŠ¤í‹°ì»¤ íšŒì „
2. **ì‹¤í–‰ ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰**: ìŠ¤í‹°ì»¤ ì¡°ì‘ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
3. **ë‹¤ì–‘í•œ í¸ì§‘ ê¸°ëŠ¥**: í•„í„°, í…ìŠ¤íŠ¸ ì¶”ê°€ ë“± í™•ì¥ ê¸°ëŠ¥ êµ¬í˜„